{% extends 'base.html.twig' %}

{% block body %}
    <style>
        #plateau li {
            display: inline-block;
            list-style-type: none;
        }
        a {
            color: inherit;
            text-decoration: none;
        }
    </style>
    <div id="plateau"></div>
    <div id="deck"></div>
    <div id="chat"></div>
    <form id="postermessage" method="post" action="{{ path('partie_posterMessage', {partie: partie.id}) }}">
        <input type="text" id="message" name="message" placeholder="Votre message...">
        <button type="submit">Envoyer</button>
    </form>
    <br/><br/>
    <ul>
        <li>
            <a href="{{ path('partie_index') }}">Back to the list</a>
        </li>
        <li>
            <a href="{{ path('partie_edit', { 'id': partie.id }) }}">Edit</a>
        </li>
        <li>
            {{ form_start(delete_form) }}
                <input type="submit" value="Delete">
            {{ form_end(delete_form) }}
        </li>
    </ul>

    {#{{ dump(partie) }}
    {{ dump(plateau) }}
    {{ dump(cartes) }}
    {{ dump(objectifs) }}
    {{ dump(joueur) }}#}
    {% endblock %}
    {% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            $("#chat").load("{{ path('partie_afficherMessages', {partie: partie.id}) }}")
            setInterval(function () {
                $("#chat").load("{{ path('partie_afficherMessages', {partie: partie.id}) }}")
                var elem = document.getElementById('chat')
                elem.scrollTop = elem.scrollHeight
            }, 3000);
            $('#postermessage').on('submit', function (e) {
                e.preventDefault()
                $.ajax({
                    url: $(this).attr('action'),
                    type: $(this).attr('method'),
                    data: $(this).serialize(),
                })
                $("#message").val('')
            })
        })
    </script>
    <script>
        $("#plateau").load("{{ path('partie_plateau', {id: partie.id}) }}")
        $(document).ready(function(){
            setInterval(function() {
                $("#plateau").load("{{ path('partie_plateau', {id: partie.id}) }}")
            }, 2000)

            $('.action_form_btn').on('click', function () {
                var cartes = []
                $("input:checked").each(function() {
                    cartes.push($(this).val())
                })
                var action = $(this).val()
                $('#action_form').submit(function(e) {
                    e.preventDefault()
                    $.ajax({
                        url: $(this).attr('action'),
                        type: 'POST',
                        data: {
                            cartes: JSON.stringify(cartes),
                            action: action
                        }
                    })
                })
            })
        })
    </script>
        {% if (joueur == 1) %}
            <script>
                $(document).ready(function() {
                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                    var cetakiInt = setInterval(function() {
                        $.ajax({
                            type: "GET",
                            url: "{{ path('partie_cetaki', {partie: partie.id}) }}",
                            success: function (res) {
                                console.log(res)
                                if(res == '2') {
                                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                                }
                            }
                        })
                    }, 10000)
                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                })
            </script>
        {% elseif (joueur == 2) %}
            <script>
                $(document).ready(function() {
                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                    var cetakiInt = setInterval(function() {
                        $.ajax({
                            type: "GET",
                            url: "{{ path('partie_cetaki', {partie: partie.id}) }}",
                            success: function (res) {
                                console.log(res)
                                if (res == '1') {
                                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                                }
                            }
                        })
                    }, 10000)
                    $("#deck").load("{{ path('partie_deck', {id: partie.id}) }}")
                })
            </script>
        {% endif %}

{% endblock %}
